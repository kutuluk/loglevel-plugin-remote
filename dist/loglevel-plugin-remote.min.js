!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.remote=r.exports}}(this,function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=window;if(!n)throw new Error("Plugin for browser usage only");var o=void 0;function i(e){try{return JSON.stringify(e)}catch(e){if(!o)try{var t={};t.a=t,JSON.stringify(t)}catch(e){o=e.message}if(e.message===o)return"[Circular]";throw e}}function a(e){var t="",r=0;return e.length>1&&"string"==typeof e[0]&&(t=(t=e[0].replace(/(%?)(%([sdjo]))/g,function(t,n,o,a){if(!n){var c=e[r+=1],l="";switch(a){case"s":l+=c;break;case"d":l+=+c;break;case"j":l=i(c);break;case"o":var s=i(c);"{"!==s[0]&&"["!==s[0]&&(s="<"+s+">"),l=function(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}(c)+s}return l}return t})).replace(/%{2,2}/g,"%"),r+=1),e.length>r&&(t&&(t+=" "),t+=e.slice(r).join(" ")),t}var c=Object.prototype.hasOwnProperty;function l(){try{throw new Error}catch(e){return e.stack}}function s(e){var t=this,r=[],n=[];this.length=function(){return r.length},this.sent=function(){return n.length},this.push=function(t){r.push(t),r.length>e&&r.shift()},this.send=function(){return n.length||(n=r,r=[]),n},this.confirm=function(){n=[],t.content=""},this.fail=function(){var o=1+r.length+n.length-e;o>0&&(n.splice(0,o),r=n.concat(r),t.confirm())}}var u=!!l(),f=void 0,p=void 0,v=void 0;function g(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function d(){throw new Error("You can't set token for a not appled plugin")}var h=n.remote,m={url:"/logger",method:"POST",headers:{},token:"",onUnauthorized:function(){},onCallback:function(){},timeout:0,interval:1e3,level:"trace",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:g},y={noConflict:function(){return n.remote===y&&(n.remote=h),y},plain:g,json:function(e){return e.level=e.level.label,e},apply:function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(f)throw new Error("You can assign a plugin only one time");if(!n.XMLHttpRequest)return e;f=e;var o=function e(){for(var t={},n=0;n<arguments.length;n+=1){var o=Object(arguments[n]);for(var i in o)c.call(o,i)&&(t[i]="object"!==r(o[i])||Array.isArray(o[i])?o[i]:e(t[i],o[i]))}return t}(m,t);o.capacity=o.capacity||500;var i=o.backoff,g="object"===(void 0===i?"undefined":r(i))?function(e){var t=e*i.multiplier;return t>i.limit&&(t=i.limit),t+=t*i.jitter*Math.random()}:i,d=o.interval,h=void 0,b=void 0,k=!1,w=!1,j=new s(o.capacity);function O(){if(!w&&!k&&void 0!==o.token){if(!j.sent()){if(!j.length())return;var e=j.send();j.content=b?'{"logs":['+e.join(",")+"]}":e.join("\n")}k=!0;var t=new n.XMLHttpRequest;t.open(o.method,o.url,!0),t.setRequestHeader("Content-Type",h),o.token&&t.setRequestHeader("Authorization","Bearer "+o.token);var r=o.headers;for(var i in r)if(c.call(r,i)){var a=r[i];a&&t.setRequestHeader(i,a)}var l=void 0;o.timeout&&(l=n.setTimeout(function(){k=!1,t.abort(),s()},o.timeout)),t.onreadystatechange=function(){if(4===t.readyState)if(k=!1,n.clearTimeout(l),200===t.status)d=o.interval,j.confirm(),s(!0),o.onCallback();else{if(401===t.status){var e=o.token;o.token=void 0,o.onUnauthorized(e)}s()}},t.send(j.content)}function s(e){e||(d=g(d||1),j.fail()),w=!0,n.setTimeout(function(){w=!1,O()},d)}}return p=e.methodFactory,v=function(e,t,r){var n=p(e,t,r),i=u&&o.stacktrace.levels.some(function(t){return t===e}),c=f.levels[e.toUpperCase()],s=c>=f.levels[o.level.toUpperCase()];return function(){for(var t=arguments.length,u=Array(t),p=0;p<t;p++)u[p]=arguments[p];if(s){var v=o.timestamp(),g=i?l():"";if(g){var d=g.split("\n");d.splice(0,o.stacktrace.excess+3);var m=o.stacktrace.depth;if(m&&d.length!==m+1)g=d.splice(0,m).join("\n"),d.length&&(g+="\n    and "+d.length+" more");else g=d.join("\n")}var y=o.format({message:a(u),level:{label:e,value:c},logger:r||"",timestamp:v,stacktrace:g});void 0===b&&(h=(b="string"!=typeof y)?"application/json":"text/plain");var k="";if(b)try{k+=JSON.stringify(y)}catch(e){return n.apply(void 0,u),void f.getLogger("logger").error(e)}else k+=y;j.push(k),O()}n.apply(void 0,u)}},e.methodFactory=v,e.setLevel(e.getLevel()),y.setToken=function(e){o.token=e,O()},e},disable:function(){if(!f)throw new Error("You can't disable a not appled plugin");if(v!==f.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");f.methodFactory=p,f.setLevel(f.getLevel()),f=void 0,y.setToken=d},setToken:d};t.default=y,e.exports=t.default});